{"version":3,"file":"index.js","sources":["../../../../node_modules/@vue/babel-helper-vue-jsx-merge-props/dist/helper.js","../../../../packages/utils/lib/toarray.js","../src/component.jsx","../../../../node_modules/style-inject/dist/style-inject.es.js","../../../../packages/utils/lib/slot.js"],"sourcesContent":["\"use strict\";function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}var normalMerge=[\"attrs\",\"props\",\"domProps\"],toArrayMerge=[\"class\",\"style\",\"directives\"],functionalMerge=[\"on\",\"nativeOn\"],mergeJsxProps=function(a){return a.reduce(function(c,a){for(var b in a)if(!c[b])c[b]=a[b];else if(-1!==normalMerge.indexOf(b))c[b]=_extends({},c[b],a[b]);else if(-1!==toArrayMerge.indexOf(b)){var d=c[b]instanceof Array?c[b]:[c[b]],e=a[b]instanceof Array?a[b]:[a[b]];c[b]=d.concat(e)}else if(-1!==functionalMerge.indexOf(b)){for(var f in a[b])if(c[b][f]){var g=c[b][f]instanceof Array?c[b][f]:[c[b][f]],h=a[b][f]instanceof Array?a[b][f]:[a[b][f]];c[b][f]=g.concat(h)}else c[b][f]=a[b][f];}else if(\"hook\"==b)for(var i in a[b])c[b][i]=c[b][i]?mergeFn(c[b][i],a[b][i]):a[b][i];else c[b]=a[b];return c},{})},mergeFn=function(a,b){return function(){a&&a.apply(this,arguments),b&&b.apply(this,arguments)}};module.exports=mergeJsxProps;\n","export default function toArray(value) {\n    return Array.isArray(value)\n        ? value\n        : ([null, undefined, ''].indexOf(value) > -1 ? [] : [value]);\n}\n","import toArray from '@form-create/utils/lib/toarray';\nimport getSlot from '@form-create/utils/lib/slot';\nimport './style.css';\n\nfunction parseFile(file, i) {\n    return {\n        url: file,\n        name: getFileName(file),\n        uid: i\n    };\n}\n\nfunction getFileName(file) {\n    return ('' + file).split('/').pop()\n}\n\nconst NAME = 'fcUpload';\n\nexport default {\n    name: NAME,\n    props: {\n        formCreateInject: {\n            type: Object,\n            required: true,\n        },\n        onHandle: {\n            type: Function,\n            default(file) {\n                this.previewImage = file.url;\n                this.previewVisible = true;\n            }\n        },\n        uploadType: {\n            type: String,\n            default: 'file'\n        },\n        limit: {\n            type: Number,\n            default: 0\n        },\n        allowRemove: {\n            type: Boolean,\n            default: true\n        },\n        previewMask: undefined,\n        modalTitle: String,\n        handleIcon: {\n            type: [String, Boolean],\n            default: () => undefined\n        },\n        value: [Array, String]\n    },\n    data() {\n        return {\n            uploadList: [],\n            previewVisible: false,\n            previewImage: '',\n            cacheFiles: [],\n        }\n    },\n    created() {\n        if (this.formCreateInject.prop.props.showFileList === undefined) {\n            this.formCreateInject.prop.props.showFileList = false;\n        }\n        this.formCreateInject.prop.props.fileList = toArray(this.value).map(parseFile);\n    },\n    watch: {\n        value(n) {\n            if (this.$refs.upload.uploadFiles.every(file => {\n                return !file.status || file.status === 'success';\n            })) {\n                this.$refs.upload.uploadFiles = toArray(n).map(parseFile);\n                this.uploadList = this.$refs.upload.uploadFiles;\n            }\n        },\n        limit(n, o) {\n            if (o === 1 || n === 1) {\n                this.update();\n            }\n        }\n    },\n    methods: {\n        key(unique) {\n            return unique;\n        },\n        isDisabled() {\n            return this.formCreateInject.prop.props.disabled === true;\n        },\n        onRemove(file) {\n            if (this.isDisabled()) {\n                return;\n            }\n            this.$refs.upload.handleRemove(file);\n        },\n        handleClick(file) {\n            this.onHandle(file);\n        },\n        makeItem(file, index) {\n            return this.uploadType === 'image'\n                ? <img src={file.url} key={this.key('img' + index)}/>\n                : <i class=\"el-icon-tickets\" key={this.key('i' + index)}/>\n        },\n        makeRemoveIcon(file, index) {\n            return <i class=\"el-icon-delete\" on-click={() => this.onRemove(file)} key={this.key('ri' + index)}/>;\n        },\n        makeHandleIcon(file, index) {\n            return <i\n                class={(this.handleIcon === true || this.handleIcon === undefined) ? 'el-icon-view' : this.handleIcon}\n                on-click={() => this.handleClick(file)} key={this.key('hi' + index)}/>;\n        },\n        makeProgress(file, index) {\n            return <ElProgress props={{percentage: file.percentage, type: 'circle', width: 52}} style=\"margin-top:2px;\"\n                key={this.key('pg' + index)}/>\n        },\n        makeIcons(file, index) {\n            const icons = [];\n            if (this.allowRemove || this.handleIcon !== false) {\n                if ((this.uploadType !== 'file' && this.handleIcon !== false) || (this.uploadType === 'file' && this.handleIcon)) {\n                    icons.push(this.makeHandleIcon(file, index));\n                }\n                if (this.allowRemove) {\n                    icons.push(this.makeRemoveIcon(file, index));\n                }\n\n                return <div class='fc-upload-cover'>{icons}</div>;\n            }\n        },\n        makeFiles() {\n            return this.uploadList.map((file, index) => this.$scopedSlots.fileList ? this.$scopedSlots.fileList({\n                file,\n                index,\n                vm: this\n            }) : <div key={this.key(index)}\n                class='fc-files'>{(file.percentage !== undefined && file.status !== 'success') ? this.makeProgress(file, index) : [this.makeItem(file, index), this.makeIcons(file, index)]}</div>);\n        },\n        makeUpload() {\n            const isShow = (!this.limit || this.limit > this.uploadList.length);\n            return <ElUpload {...this.formCreateInject.prop} ref=\"upload\"\n                style={{display: 'inline-block'}}\n                key={this.key('upload')}>\n                {isShow ? <template slot=\"default\">\n                    {this.$slots.default || <div class='fc-upload-btn'>\n                        <i class=\"el-icon-upload2\"/>\n                    </div>}\n                </template> : null}{getSlot(this.$slots, ['default'])}\n            </ElUpload>;\n        },\n        update() {\n            let files = this.$refs.upload.uploadFiles.map((file) => file.url).filter((url) => url !== undefined);\n            if (this.cacheFiles.length !== files.length) {\n                this.cacheFiles = [...files];\n                this.$emit('input', this.limit === 1 ? (files[0] || '') : files);\n            }\n        },\n        handleCancel() {\n            this.previewVisible = false;\n        },\n    },\n    render() {\n        if (this.$refs.upload) {\n            if (this.formCreateInject.prop.props.showFileList === undefined) {\n                this.formCreateInject.prop.props.showFileList = this.$refs.upload.showFileList;\n            }\n            this.formCreateInject.prop.props.fileList = this.$refs.upload.fileList;\n        }\n        return (\n            <div\n                class='_fc-upload'>{[this.formCreateInject.prop.props.showFileList ? [] : this.makeFiles(), this.makeUpload()]}\n                <el-dialog\n                    props={{\n                        appendToBody: true,\n                        modal: this.previewMask,\n                        title: this.modalTitle,\n                        visible: this.previewVisible\n                    }}\n                    on-close={this.handleCancel}>\n                    <img alt=\"example\" style=\"width: 100%\" src={this.previewImage}/>\n                </el-dialog>\n            </div>);\n    },\n    mounted() {\n        this.uploadList = this.$refs.upload.uploadFiles;\n        this.$watch(() => this.$refs.upload.uploadFiles, () => {\n            this.update();\n        }, {deep: true});\n    }\n}\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","export default function getSlot(slots, exclude) {\n    return Object.keys(slots).reduce((lst, name) => {\n        if (!exclude || exclude.indexOf(name) === -1) {\n            lst.push(slots[name])\n        }\n        return lst;\n    }, [])\n}"],"names":["_extends","Object","assign","a","b","c","arguments","length","d","prototype","hasOwnProperty","call","apply","this","normalMerge","toArrayMerge","functionalMerge","mergeFn","reduce","indexOf","Array","e","concat","f","g","h","i","toArray","value","isArray","undefined","parseFile","file","url","name","getFileName","uid","split","pop","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","props","formCreateInject","required","onHandle","Function","previewImage","previewVisible","uploadType","String","limit","Number","allowRemove","Boolean","previewMask","modalTitle","handleIcon","data","uploadList","cacheFiles","created","prop","showFileList","fileList","map","watch","n","$refs","upload","uploadFiles","every","status","o","update","methods","key","unique","isDisabled","disabled","onRemove","handleRemove","handleClick","makeItem","index","makeRemoveIcon","_this","makeHandleIcon","_this2","makeProgress","percentage","width","makeIcons","icons","push","makeFiles","_this3","$scopedSlots","vm","makeUpload","slots","exclude","isShow","display","$slots","keys","lst","files","filter","$emit","handleCancel","render","appendToBody","modal","title","visible","mounted","$watch","_this4","deep"],"mappings":"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"}